spawnConfig.idleDelay 如果是0 就一直循环idleAnimation 
如果spawnConfig.idleDelay 如果是1 ，1以后进入巡逻



两个怪碰到一起 也要转向   或  穿插 

还有就是巡逻阶段，巡逻的时候只给移动系（moveAnimation 和 restAnimation）添加一个选项，这个选项是（自动转向 或 自动跳跃过去），转向已经做好，接下来的功能就是是否遇到障碍或悬崖自动跳跃过去，跳跃过去以后还是接巡逻阶段移动或休息，再悬崖墙壁自动跳跃期间要把移动系从新开始，落地后移动系从新开始计算
这个跳跃所使用的底层逻辑 和  巡逻 跳跃系（jumpAnimation 和 jumpRestAnimation）一致，代码底层用一个，比如跳跃改了什么算法，这个也会改，但是面板要单独，因为悬崖峭壁自动跳跃这个比  跳跃系要有不同，  

巡逻跳跃系不加这个功能，没有悬崖峭壁自动跳跃这个功能，但是会转向们已经做好

悬崖和 墙壁能不能跳上去 也要有检测  ，检测就是再场景会摆放boxcolloder2d istrigger  ，怪物撞到就检测可以跳跃  ，不需要判断多高墙 多远悬崖 ，判断完全由关卡控制  

如果怪物没有撞到boxcolloder2d istrigger 检测体，撞到墙了，还是会正常转向，也就是 没有boxcolloder2d istrigger  的时候怪物和之前一样 转向，所以这个自动跳跃要用两种结合判断，平时都是悬崖墙壁转向，遇到有boxcolloder2d istrigger   就自动跳，所以自动跳时满足两个条件：既要转向条件满足，又要有boxcolloder2d istrigger，因为从悬崖这边（有boxcolloder2d istrigger）自动跳到悬崖那边（也有boxcolloder2d istrigger），那可能就触发了两次


怪物和怪物之间是可以穿插的 ，但会不会 闪烁
角色和怪物也是可以穿插的（因为角色未来做伤害会有伤害动画和击退效果，所以穿插也还好，暂时不做）

WALL层是 踩墙使用

编辑器 当选择直线运动 并且 可以障碍跳跃的时候  下面的 跳跃设置就 障碍跳跃的设置 



关于角色出生在相机 锁定区域解法

首先角色是否在 CameraZone 这个物体里，如果在 ，相机的位置在哪里这个是关键，
需要知道这个检测体左边的边位置 和 右边边的位置，可以人为 的在CameraZone 这个物体的脚本里 打左或右标签，如果打的是右标签，那这个相机位置就是 CameraZone 这个检测体右边的边 位置（角色Component  与 CameraZone 这个检测体右边的边 交点位置）
角色出生的时候相机要被矫正到这个位置  
另外 人物身上用点检测场景CameraZone 检测体


新需求 
怪物可以走包括45度以下的斜坡，现在是走到斜坡就停下了， 不断地抖，还会斜坡滑下来
45度以下的可以走上去  ，以上的要转向

直线移动走包括45度以下的斜坡停下休息的 时候可以站住 
跳跃主要是跳到包括45度以下的斜坡，休息的时候可以停住

和自动跳跃没关系，不要碰到了相关代码
转向考虑下45度以上斜坡才转向

物理还是要用rigidbody dynamic



patrolConfig.patrolPoints 这里给了两点位置patrolConfig.patrolPoints.Array.data[0]h和patrolConfig.patrolPoints.Array.data[1]后，怪物并没有再两点之间移动 正常怪物出生的位置 走到两点patrolConfig.patrolPoints.Array.data[0]点 再 走 到patrolConfig.patrolPoints.Array.data[1]点 patrolConfig.pingPong 如果勾上就是一直循环，不勾上就不走点


patrolConfig.patrolPoints 这个点同样对跳跃也有用，再两点之间跳跃，两点之间如果跳跃不能过点，到点上方X轴速度为0，怪物垂直落下 选择点之间移动或跳跃 同样支持 转向和自动跳跃 所以摆点的时候会注意不要和 自动跳跃检测体重叠，优先级不用考虑


把脚本分出来了

“MonsterController 只做编排”版本和5个独立逻辑脚本
自动跳跃 = 跳跃内核（JumpCore）+ 自动编排（AutoJumpDriver）

JumpCore 只做物理：起跳、重力、SafeMoveVertical、落地判定；不管许可区/上膛/抑制窗口/转向。

AutoJumpDriver 只做“自动”策略：许可区上膛/保险、落地后悬崖抑制帧、调用 JumpCore 起跳&空中核（你之前的变量、窗口语义完全保留）。

MonsterController

自动转向（AutoTurnLogic）：墙/悬崖检测 + TurnAround 封装，墙线从“脚底+偏移”发射，wallCheckHeightOffset 调节立即可见。

MonsterController

地面直线段（GroundMoveLogic）：遇障碍→优先试自动跳，否则转向；修复了你之前“抑制窗口被第二次 CheckCliffAhead 覆盖”的问题（只用一次合并结果）。

MonsterController







第1个需求
MonsterController要借鉴PlayerController 的移动 跳跃 斜坡移动 斜坡静止 平地走上斜坡  斜坡走下平地  向上走斜坡速度 和向下走胁迫速度要与平地走斜坡速度相同  等物理方式，并且适合怪物编辑器

第2个需求
需要和第1个需求匹配，就是第一个需求好的同时还能满足第2个需求

怪物编辑器已经有一个版本了
完善当前的版本
具体如下：
spawnConfig 出生阶段 这块不用管 已经OK

接下来就是patrolConfig 巡逻阶段

patrolConfig.patrolPoints 这个是生成点，怪物再点之间移动，选择了这个方式怪物就不会自动跳跃了 自动转向了 完全靠点，几个点之间移动
patrolConfig.pingPong 这个功能可以删掉
patrolConfig.movements 这个是可以指定不同的巡逻移动状态 ，有直线移动 和 跳跃移动 ，可以再列表里+ 加入element0、element1……很多状态
patrolConfig.movements.Array.data[0].executeCount，内部element0执行几次 

patrolConfig.randomOrder 勾上就是列表里element0、element1……一直随机，不勾就是按顺序element0、element1……一直循环
patrolConfig.loopAll 这个功能可以删掉

再patrolConfig.movements下element0
patrolConfig.movements.Array.data[0].type  设置类型 straight 或 jump
选择 straight的时候的参数
patrolConfig.movements.Array.data[0].moveSpeed  匀速速度  
patrolConfig.movements.Array.data[0].acceleration  加速度 起步时候  0  加速到  匀速速度   ，如果设置是0  ，没有加速度，直接到达匀速速度
还要增加一个加速时间 缺失
patrolConfig.movements.Array.data[0].deceleration  减速度 减速时候   匀速速度     减速到 0，如果设置是0  ，没有减速度，直接匀速速度降到0
还要增加一个减速时间 缺失
patrolConfig.movements.Array.data[0].restDuration  休息停顿时间  

patrolConfig.movements.Array.data[0].moveAnimation  怪物移动动画
patrolConfig.movements.Array.data[0].restAnimation   怪物休息动画
patrolConfig.movements.Array.data[0].moveEffectOnlyFirst   移动特效是否只播放一次，选择勾上，动画帧触发播放一次就不再播放，不勾就是训话播放
patrolConfig.movements.Array.data[0].moveEffectPrefab  指定怪物移动中动画帧（OnPatrolMoveEffect）事件播放特效  
patrolConfig.movements.Array.data[0].restEffectOnlyFirst  休息特效是否只播放一次，选择勾上，动画帧触发播放一次就不再播放，不勾就是训话播放
patrolConfig.movements.Array.data[0].restEffectPrefab   指定怪物休息中的动画帧（OnPatrolRestEffect）事件播放特效

patrolConfig.movements.Array.data[0].obstacleBehavior  自动类型 turn 或 auto jump 
选择turn 怪物走到悬崖或墙壁 会自动转向 朝自己朝向的方向移动   墙壁和悬崖已经有检测参数 
wallCheckDistance  检测长度
wallCheckHeightOffset   上下偏移
cliffCheckDistance  检测长度
cliffCheckOffsetX     偏移

auto jump 选项可以删掉  默认都是turn
因为auto jump 是由怪物撞到场景的autoJumpPermitTag的物体就会跳跃（跳跃以后autoJumpIgnoreCliffFrames 8帧不检测 悬崖和 自动跳跃，以免连续）并且撞到墙壁也会转向，所以不需要选项，默认就是turn 


下面的是autoJumpPermitTag触发怪物跳跃的参数
参数
patrolConfig.movements.Array.data[0].autojumpSpeed 匀速速度 X
patrolConfig.movements.Array.data[0].autojumpHeight 跳跃高度 Y
patrolConfig.movements.Array.data[0].autogravityScale  向下重力 系数  ，系数 * 怪物rb2d 下GravityScale 这个值要给>0
patrolConfig.movements.Array.data[0].autojumpDuration  跳跃持续时间  指空中到落地时间，并且这时候 gravityScale 失效 

资源
patrolConfig.movements.Array.data[0].jumpAnimation 怪物跳跃动画
patrolConfig.movements.Array.data[0].jumpRestAnimation 怪物跳跃休息动画
patrolConfig.movements.Array.data[0].jumpEffectOnlyFirst 跳跃特效是否只播放一次，选择勾上，动画帧触发播放一次就不再播放，不勾就是训话播放
patrolConfig.movements.Array.data[0].jumpEffectPrefab  指定怪物跳跃中动画帧（OnPatrolJumpEffect）事件播放特效  
patrolConfig.movements.Array.data[0].jumpRestEffectOnlyFirst 跳跃休息特效是否只播放一次，选择勾上，动画帧触发播放一次就不再播放，不勾就是训话播放
patrolConfig.movements.Array.data[0].jumpRestEffectPrefab 指定怪物跳跃休息中的动画帧（OnPatrolJumpRestEffect）事件播放特效


当选择 jump的时候的参数
参数
patrolConfig.movements.Array.data[0].jumpSpeed 匀速速度 X
patrolConfig.movements.Array.data[0].jumpHeight 跳跃高度 Y
patrolConfig.movements.Array.data[0].gravityScale  向下重力 系数  ，系数 * 怪物rb2d 下GravityScale    
patrolConfig.movements.Array.data[0].jumpDuration 跳跃持续时间  
patrolConfig.movements.Array.data[0].restEffectPrefab跳跃休息时间 

moveDuration  是跳跃总体时间，比如跳跃速度 重力 让怪物再空中跳跃了3S，设置总时间是2S，那还是按照3S算，只不过落地后大于设定值2S就不跳跃了，如果跳跃速度 重力 让怪物再空中跳跃了3S，总时间是7S，那就让怪物再跳跃2次，落地后因为还剩1秒，所以还要再跳一次
restDuration 是moveDuration 执行完后的最后一跳落地开始计算，落地跳跃休息 不动 

资源
patrolConfig.movements.Array.data[0].jumpAnimation 怪物跳跃动画
patrolConfig.movements.Array.data[0].jumpRestAnimation 怪物跳跃休息动画
patrolConfig.movements.Array.data[0].jumpEffectOnlyFirst 跳跃特效是否只播放一次，选择勾上，动画帧触发播放一次就不再播放，不勾就是训话播放
patrolConfig.movements.Array.data[0].jumpEffectPrefab  指定怪物跳跃中动画帧（OnPatrolJumpEffect）事件播放特效  
patrolConfig.movements.Array.data[0].jumpRestEffectOnlyFirst 跳跃休息特效是否只播放一次，选择勾上，动画帧触发播放一次就不再播放，不勾就是循环播放
patrolConfig.movements.Array.data[0].jumpRestEffectPrefab 指定怪物跳跃休息中的动画帧（OnPatrolJumpRestEffect）事件播放特效

patrolConfig.movements.Array.data[0].obstacleBehavior 默认就是 turn 
怪物跳跃撞到墙壁的时候会转向，已经转向后等8帧后再检测，防止一直检测抖动，另外悬崖不检测转向，跳跃仅仅是撞上前方墙才转向
当然也支持怪物跳跃中撞到场景的autoJumpPermitTag的物体再次跳跃，跳跃空中撞到autoJumpPermitTag的物体，从触发那一刻为起点再次跳跃

autoJumpPermitTag 的自动跳跃可以和 type设置类型jump参数不同，资源配置相同

编辑器面板优化，巡逻阶段
选择type  设置类型 straight
直线移动参数和资源
自动跳跃参数和资源

选择type  设置类型 jump
跳跃参数和资源
自动跳跃参数和资源
自动跳跃与跳跃参数不同 ，资源相同

请把以上1和2功能完善，不要删除原来这几个脚本功能配置，需要删除的上面的说明也写了，有些字段虽然是空的，但也是策划预留的一部分
不需要完整代码，不用解释为什么，贴出来代码要改动的位置，怎么替换或删除或增加，不要漏掉




调整下规则

正常跳跃  
moveDuration  是跳跃总体时间，比如跳跃速度 重力 让怪物再空中跳跃了3S，设置总时间是2S，那还是按照3S算，只不过落地后大于设定值2S就不跳跃了，如果跳跃速度 重力 让怪物再空中跳跃了3S，总时间是7S，那就让怪物再跳跃2次，落地后因为还剩1秒，所以还要再跳一次
restDuration 是moveDuration 执行完后的最后一跳落地开始计算，落地跳跃休息 不动 

自动跳跃
patrolConfig.movements.Array.data[0].autojumpSpeed   空中全程都有速度
patrolConfig.movements.Array.data[0].autojumpHeight   
patrolConfig.movements.Array.data[0].autogravityScale
patrolConfig.movements.Array.data[0].automoveDuration   同正常跳跃 设置
patrolConfig.movements.Array.data[0].restDuration 加回来   同正常跳跃 设置

现在结果是 自动跳跃到最高点就垂直掉下来，没有继续往前跳，（补充：怪物撞到AutoJumpZone后，自动跳跃和悬崖就不能再触发，要落地后等autoJumpIgnoreCliffFrames的帧数后才可以触发；但是墙壁的转向要保留，可能跳过去以后墙壁自动转向




自查代码
patrolConfig.movements.Array.data[0].moveAnimation  没指定动画是不能播moveAnimation动画 和 不能播moveEffectPrefab特效的
patrolConfig.movements.Array.data[0].restAnimation  没指定动画是不能播restAnimation动画 和 不能播restEffectPrefab特效的
patrolConfig.movements.Array.data[0].moveEffectPrefab   没指定prefab  ，而动画里给了关键帧onfx ,并且给了特效prefab名字，也不能播moveEffectPrefab特效
patrolConfig.movements.Array.data[0].restEffectPrefab   没指定prefab ，而动画里给了关键帧onfx ,并且给了特效prefab名字，也不能播restEffectPrefab特效
patrolConfig.movements.Array.data[0].moveEffectPrefab   指定了prefab  ，而动画里没给关键帧onfx ,也不能播moveEffectPrefab特效
patrolConfig.movements.Array.data[0].restEffectPrefab   指定了prefab ，而动画里没给关键帧onfx ,也不能播restEffectPrefab特效

patrolConfig.movements.Array.data[0].jumpAnimation  没指定动画是不能播jumpAnimation 和 不能播jumpEffectPrefab特效的
patrolConfig.movements.Array.data[0].jumpRestAnimation  没指定动画是不能播jumpRestAnimation 和 不能播jumpRestEffect特效的
patrolConfig.movements.Array.data[0].jumpEffectPrefab   没指定prefab  ，而动画里给了关键帧onfx ,并且给了特效prefab名字，也不能播jumpEffectPrefab特效
patrolConfig.movements.Array.data[0].jumpRestEffectPrefab    没指定prefab ，而动画里给了关键帧onfx ,并且给了特效prefab名字，也不能播jumpRestEffect特效
patrolConfig.movements.Array.data[0].moveEffectPrefab   指定了prefab  ，而动画里没给关键帧onfx ,也不能播jumpEffectPrefab特效
patrolConfig.movements.Array.data[0].restEffectPrefab   指定了prefab ，而动画里没给关键帧onfx ,也不能播jumpRestEffect特效

自动跳跃资源逻辑同正常跳跃



s动画关键帧还是单独的 ，因为动画可以相同、指定特效也可能相同、但是一条动画里这个动画关键帧一定不同，也绝对不会指定两个相同关键帧
spawnEffectPrefab
idleEffectPrefab
moveEffectPrefab
restEffectPrefab
jumpEffectPrefab
jumpRestEffectPrefab

保持规则：
没有配置动画/Prefab 时，任何情况下都不能播动画/特效；
动画里没给关键帧事件也不能播放特效；
配置了 Prefab 但关键帧事件没给也不能播放特效；
没有在当前段配置的 Prefab 即便 关键帧事件 给了名字也不能播放特效


堆栈执行
 配置了Element0  ，自循环，  正确
如果再配置 Element1，还是   Element0  ，自循环，错误，应该是Element0、Element1、Element0循环下去
如果再配置Element2，Element0、Element1、Element2顺序循环
如果勾选了patrolConfig.randomOrder，随机再Element0、Element1、Element2循环

移动/停下/跳跃/自动转向/自动跳跃/动画/特效全部走“非路点巡逻”的同一套底层逻辑。
路点只用来“到点就推进下一个（0..N..0）并在接地且允许转向时纠正朝向”。跳跃可越过路点，不会被中途强制拐头；落地恢复直线相位后再朝目标纠正。


要给巡逻阶段特效增加 位置点 fxSpawnPoint、fxIdlePoint、fxMovePoint、fxRestPoint、fxJumpPoint、fxJumpRestPoint




首先发现阶段的模式 移动发现 和跳跃发现 ，相当于巡逻阶段类型移动和跳跃，只不过没有路点 

所以代码应该怎么设计，比如 巡逻类型 移动类型 和  跳跃类型里面的参数 配置 逻辑 资源 动画 特效 规则 转向 自动跳跃 这些都好了 ，后面就不会再动了，巡逻阶段也不会再动了，后面新增加的比如发现阶段也是引用，巡逻阶段的底层，参数是新的一套、动画特效新的一套，底层没区别 
讨论下代码是不是需要拆分出来 或者 不拆分 

发现阶段多了一个与玩家的直线距离判断，设定的距离内，背对玩家怪物会转向转向朝玩家移动或跳跃移动，没有被动直接朝玩家移动或跳跃移动

发现阶段的模式 移动发现 和跳跃发现  ，各自独立的参数 动画 特效配置，动画特效配置同巡逻特效动画配置方式一样


先介绍移动发现阶段里面分3种状态：
1发现移动距离：一直朝向玩家方向移动 ，这个就是直接判断与玩家间距离，
怪物与玩家互动：怪物发现玩家后，玩家逃走超出了判定距离，就回到巡逻移动阶段，如果怪物一直保持和玩家发现距离内，怪物就一直追赶
参数设定: findmoveSpeed、findacceleration、findaccelerationTime、finddeceleration、finddecelerationTime、findmoveDuration、findrestDuration   底层逻辑公用巡逻阶段，参数全新
动画资源: prefabfindmoveAnimation、findrestAnimation    
特效prefab：findmoveEffectPrefab、findrestEffectPrefab  (支持prefab 或序列帧动画)   
动画播放特效关键帧:findmoveEffectPrefab、findrestEffectPrefab     动画关键帧触发特效的规则同巡逻阶段 移动

2发现后退移动距离：朝玩家反方向后退移动，怪物走到玩家的多少距离后会转向后退移动， 
怪物与玩家互动: 首要条件是怪物发现了，再发现距离之内，所以后退距离一定小于发现距离，当怪物接近玩家再发现后退距离以内，怪物就后退，后退中如果怪物设置了休息（不动）的时候，需要转向玩家（背对玩家走一段，休息转过来看看玩家的这种感觉），如果玩家继续追赶再转头背对玩家移动
当怪物接近玩家再发现后退距离以外，进入正常发现距离阶段，怪物就朝向玩家追赶，形成拉锯
参数设定:  同发现倒退移动距离
动画资源：发现移动距离
特效prefab：发现移动距离
动画播放特效关键帧 ：发现移动距离

3发现倒退移动距离 ：向玩家反方向倒退（脸朝玩家，方向向后倒着走），怪物走到玩家的多少距离后会倒退， 新参数: 发现倒退距离 
怪物与玩家互动：首要条件是怪物发现了，再发现距离之内，所以倒退距离一定小于发现距离，怪物接近玩家再发现倒退距离以内，怪物就倒退，后退中如果怪物设置了休息（不动）的时候，需要怪物停下
当怪物接近玩家再发现倒退距离以外，进入正常发现距离阶段，怪物就追赶，形成拉锯
参数设定: backmoveSpeed、backacceleration、backaccelerationTime、backdeceleration、backdecelerationTime、backmoveDuration、 backrestDuration 底层逻辑公用巡逻阶段，参数全新
动画资源：backmoveAnimation，休息同发现移动距离休息
特效prefab：发现移动距离
动画播放特效关键帧 ：发现移动距离


现在介绍跳跃发现阶段里面分3种状态：
1发现跳跃距离：一直朝向玩家方向跳跃 ，这个就是直接判断与玩家间距离（跳跃超过了设定距离也要完成那次跳跃，落地后再调整）
怪物与玩家互动：怪物发现玩家后，玩家逃走超出了判定距离，就回到巡逻跳跃阶段，如果怪物一直保持和玩家发现距离内，怪物就一直跳跃追赶
参数设定: findjumpSpeed 、findjumpHeight、  findgravityScale、 findjumpDuration、findjumpRestDuration  底层逻辑公用巡逻阶段，参数全新
动画资源: findjumpAnimation、findjumpRestAnimation
特效prefab:findjumpEffectPrefab、findjumpRestEffectPrefab (支持prefab 或序列帧动画)
动画播放特效关键帧: findjumpEffectPrefab、findjumpRestEffectPrefab 动画关键帧触发特效的规则同巡逻阶段 跳跃

2发现后退跳跃距离：朝玩家反方向后退跳跃，怪物走到玩家的多少距离后会转向后退跳跃 （跳跃超过了设定距离也要完成那次跳跃，落地后再调整）
怪物与玩家互动: 首要条件是怪物发现了，再发现距离之内，所以后退跳跃距离一定小于发现跳跃距离，当怪物接近玩家再发现后退距离以内，怪物就后退跳跃，后退跳跃中怪物也设置了休息（不动），如果实际跳跃时间小于设定时间，多跳一次，落地才开始计算休息时间，如果实际跳跃时间大于设定时间，设定时间到了也要完成最后一跳，落地计算休息时间，这个和巡逻期间跳跃底层设计一样
当怪物接近玩家再发现后退跳跃距离以外，进入正常发现跳跃距离阶段，怪物就朝向玩家跳跃追赶，形成拉锯
参数设定: 发现倒退跳跃距离参数
动画资源：发现跳跃距离
特效prefab：发现跳跃距离
动画播放特效关键帧 ：发现跳跃距离

3发现倒退跳跃距离 ：向玩家反方向倒退跳跃（脸朝玩家，方向向后倒着跳跃），怪物跳跃到玩家的多少距离后会倒退跳跃 （跳跃超过了设定距离也要完成那次跳跃，落地后再调整）
怪物与玩家互动：首要条件是怪物发现了，再发现距离之内，所以倒退跳跃距离一定小于发现跳跃距离，怪物接近玩家再发现倒退距离以内，怪物就倒退跳跃，倒退跳跃中如果怪物设置了休息（不动）的时候，需要怪物落地后转向玩家（背对玩家跳跃一段，落地后休息转过来看看玩家的这种感觉）如果实际跳跃时间小于设定时间，也要多跳一次，落地才开始计算休息时间，如果实际跳跃时间大于设定时间，设定时间到了也要完成最后一跳，落地计算休息时间，这个和巡逻期间跳跃底层设计一样
当怪物接近玩家再发现倒退跳跃距离以外，进入正常发现跳跃距离阶段，怪物就跳跃追赶，形成拉锯
参数设定: backjumpSpeed、backjumpHeight、backgravityScale、backjumpDuration、backjumpRestDuration  底层逻辑公用巡逻阶段，参数全新
动画资源: backjumpAnimation、休息发现跳跃距离休息
特效prefab：发现跳跃距离
动画播放特效关键帧:  发现跳跃距离

以上移动发现和跳跃发现增加3个公用参数：发现距离参数（公用：发现移动距离和发现跳跃距离）、发现后退距离参数（公用：发现后退移动距离和发现后退跳跃距离）、发现倒退距离 参数（公用：发现倒退移动距离 和 发现倒退跳跃距离）需要绘制这3根线的显示圆圈，方便调试，发现距离红色，发现后退距离白色，发现倒退距离黑色，不需要定制颜色，直接给颜色

发现阶段的模式  可以列表+ 添加  移动发现  或 跳跃发现 ,elevent0自己循环，如果添加了elevent0、elevent1，elevent0与elevent1按顺序循环
findrandomOrder 勾上随机播放elevent

特效位置得锚点（已作废，全部换成了巡逻阶段的锚点）
FX_FindMove / FindMovePoint
FX_FindRest / FindRestPoint
FX_FindJump / FindJumpPoint
FX_FindJumpRest / FindJumpRestPoint
FX_BackMove / BackMovePoint
FX_BackRest / BackRestPoint
FX_BackJump / BackJumpPoint
FX_BackJumpRest / BackJumpRestPoint


发现阶段，再倒退或后退中给一个选项，就在backRange的下方
如果勾上就是怪物靠近墙壁或悬崖就自动朝玩家方向跳跃，如果不勾保持现有代码已有原状态

另外reverseRange阶段会让怪物休息的时候朝向玩家，这个可以去掉，休息的时候不在朝向玩家

发现阶段后退和倒退距离休息期间，要关闭后退和倒退的检测距离，例如：后退和倒退移动结束以后，进入休息时间10S，这10S内后退和倒退距离检测关闭，这时候如果玩家再发现距离内， 就执行发现移动或发现跳跃，10S以后玩家还在后退和倒退距离检测内，就执行后退倒退移动或跳跃


再发现阶段里还有攻击

攻击列表+ 添加  攻击0 elevent0自己循环，如果添加了攻击0 elevent0、攻击1 elevent1，攻击0 elevent0与攻击1 elevent1按顺序循环
elevent0 下的参数：
攻击类型：近战攻击  和 远程攻击


1近战攻击 
近战攻击距离：近战检测距离，只要再这个距离内，怪物就要攻击，播放攻击动画（需要绘制近战检测距离的圆圈 黄色，不需要定制颜色，直接给颜色）
攻击时间：攻击时间内怪物发出攻击，如果设定攻击时间<攻击动画时间，强制攻击结束，进入攻击休息时间；如果设定攻击时间>攻击动画时间，设定攻击时间除攻击动画时间 向上取整，结束攻击动画再计算攻击休息时间
攻击休息时间：攻击时间结束后，进入攻击休息时间，关闭攻击距离检测，发现移动距离 或 发现后退移动距离 或 发现倒退移动距离自动生效，例如：攻击最后一帧结束以后，间隔10S，10S内攻击距离检测关闭，这时候如果玩家再发现后退移动距离内 就执行发现后退 或者 再发现倒退移动距离内 就发现倒退 或者 发现移动距离内 就发现移动
攻击动画资源：attackAnimation

攻击特效prefab：attackEffectPrefab
攻击动画播放特效关键帧 ：attackEffectPrefab    
（如果添加了elevent1，那elevent1下面的
攻击动画资源：attackAnimation
攻击特效prefab：attackEffectPrefab (支持prefab 或序列帧动画)
攻击动画播放特效关键帧 ：attackEffectPrefab    
是新的资源，与elevent0不同）

近战攻击
动画attackAnimation 里 对应播放特效关键帧 attackEffectPrefab    ，关键帧对应的特效是attackEffectPrefab    
缺少动画attackAnimation不能播放特效attackEffectPrefab
缺少关键帧attackEffectPrefab不能播放特效attackEffectPrefab

近战攻击伤害检测体：可以给怪物新子物体指定collider2d istrigger ，并且再attackAnimation 动画内指定function 攻击判定帧 attackAnimationstart、attackAnimationend，再此期间攻击判定

攻击中有移动中攻击或跳跃中攻击：

移动中攻击：
播放攻击动画的同时可以给怪物移动速度，这个没有资源，只提供移动
参数：
attackmoveSpeed、attackacceleration、attackaccelerationTime、attackdeceleration、attackdecelerationTime ，attackmoveDuration，
这几个参数只在攻击时间内有效，攻击休息时间失效，这些只提供移动效果，没有动画特效，这里的移动中攻击的移动逻辑同巡逻移动底层逻辑一致。
举例：由速度0加速1S后到匀速速度1，匀速速度1再匀速移动1S，由匀速速度1减到0速需要1S

跳跃中攻击：
播放攻击动画的同时可以给怪物跳跃能力，这个没有资源，只提供跳跃
参数：
attackjumpSpeed 、attackjumpHeight、  attackgravityScale、 attackjumpDuration、attackjumpRestDuration ，当设定跳跃时间>攻击动画时间 = 空中攻击最后一帧一直保持到落地，落地后才算完成一次攻击；当设定跳跃时间<攻击动画时间 = 攻击结束最后一帧算完成一次攻击 ；这些只提供跳跃效果，没有动画特效，这里的跳跃中攻击的跳跃逻辑同巡逻移跳跃层逻辑一致





2远程攻击
远程攻击距离：远程攻击检测距离，只要再这个距离内，怪物就要攻击，播放远程攻击动画（需要绘制远程攻击检测距离的圆圈 蓝色，不需要定制颜色，直接给颜色）
远程攻击时间：远程攻击时间内怪物发出攻击，如果远程攻击时间<远程攻击动画时间，强制远程攻击结束，进入远程攻击休息时间；如果远程攻击时间>远程攻击动画时间，只远程攻击一次，停留在远程攻击最后一帧，直到远程攻击时间结束
远程攻击休息时间：远程攻击时间结束后，进入远程攻击休息时间，关闭远程攻击距离检测，发现移动距离 或 发现后退移动距离 或 发现倒退移动距离自动生效，例如：远程攻击最后一帧结束以后，间隔10S，10S内远程攻击距离检测关闭，这时候如果玩家再发现后退移动距离内 就执行发现后退 或者 再发现倒退移动距离内 就发现倒退 或者 发现移动距离内 就发现移动
攻击动画资源：attackFarAnimation
远程攻击特效prefab：attackFarEffectPrefab (支持prefab 或序列帧动画)
远程攻击动画播放特效关键帧 ：attackFarEffectPrefab    （如果添加了elevent1，那elevent1下面的远程攻击动画资源：attackFarAnimation远程攻击特效prefab：attackFarEffectPrefab远程攻击动画播放特效关键帧 ：attackFarEffectPrefab    是新的资源，与elevent0不同）

远程移动中攻击：
播放远程攻击动画的同时可以给怪物移动速度
参数：
attackFarmoveSpeed、attackFaracceleration、attackFaraccelerationTime、attackFardeceleration、attackFardecelerationTime ，这几个参数只在攻击时间内有效，攻击休息时间失效，这些只提供移动效果，没有动画特效，这里的移动逻辑同巡逻移动底层逻辑一致。
举例：由速度0加速1S后到匀速速度1，匀速速度1再匀速移动1S，由匀速速度1减到0速需要1S

远程跳跃中攻击：
播放攻击动画的同时可以给怪物跳跃能力
参数：
attackjumpSpeed 、attackjumpHeight、  attackgravityScale、 attackjumpDuration、attackjumpRestDuration ，当攻击动画时间<跳跃时间 = 空中攻击最后一帧一直保持到落地，落地后才算完成一次攻击；当攻击动画时间>跳跃时间 = 攻击结束最后一帧算完成一次攻击 ；这些只提供跳跃效果，没有动画特效，这里的跳跃中攻击的跳跃逻辑同巡逻移跳跃层逻辑一致

远程攻击飞行物释放位置：可以给怪物新子物体(空物体)指定 ，并且再attackFarAnimation 动画内指定function 攻击判定帧 attackFarAnimation，再这帧以及怪物的子物体上释放远程攻击飞行物


远程攻击飞行物：
参数：
飞行物绑定怪物子物体位置
飞行物攻击伤害检测，可以指定collider2d istrigger
飞行物同时发射个数
飞行物同时发射个数间隔时间（例如一次发3颗，每颗间隔0.2S）
飞行物发射频率完全取决于远程攻击动画播放特效关键帧attackFarEffectPrefab   
每个飞行物存活：时间
飞行物释放扇形：扇形角度，随机或均匀分布
飞行物动画资源：FlygunAnimation
飞行物特效资源：FlygunEffectPrefab (支持prefab 或序列帧动画)


远程攻击飞行物类型

飞行物直线移动
参数：
直线移动朝向：自定义角度移动或一直朝玩家方向移动
直线移动匀速速度
直线移动匀速时间
直线移动加速度：飞行物起步移动的时候加速
直线移动加速度时间
直线移动减速度：飞行物停下的时候减速
直线移动减速度时间
举例：由速度0加速1S后到匀速速度1，匀速速度1再匀速移动1S，由匀速速度1减到0速需要1S
停下休息时间，移动一段时间后停下休息不动
是否跟踪玩家，可设置跟踪强度比%，直线与跟踪混合强度
跟踪的参数飞行物直线移动参数，不需要设置

直线移动类型包括：S型直线sin移动、直线回旋镖、旋转移动、抛物线移动
如果勾选跟踪，以下飞行类型都再跟踪基础上跟踪S型直线sin移动、跟踪直线回旋镖、跟踪旋转移动、跟踪抛物线移动

S型直线sin移动：飞行物自身sin旋转
sin 参数：振幅（例如：上下摆动2米）和频率（例如：每秒摆动3次）
是否一直朝着移动方向，如果是沿着移动方向旋转（自动面向路径切线）如果否不改变自身朝向

直线回旋镖：飞行物飞出去停顿后再飞回来
参数：飞出最远距离、最远距离停顿时间、回旋回来移动匀速速度、回旋回来移动匀速速度时间、回旋回来移动加速度、回旋回来移动加速度时间、回旋回来移动减速度、回旋回来移动减速度时间
是否一直朝着移动方向，如果是沿着移动方向旋转（自动面向路径切线），如果否不改变自身朝向

旋转移动：飞行物按照一定半径圆形轨迹按照直线速度speed螺旋旋转前进飞行
参数：旋转半径、角速度
是否一直朝着移动方向，如果是沿着移动方向旋转（自动面向路径切线），如果否不改变自身朝向

抛物线移动：飞行物撞到场景碰撞体会反弹
参数：
发射角度：按照直线速度speed，按照设定角度释放
向下的力：受到向下的力影响会抛物线下坠
是否反弹力：勾上就会反弹
是否一直朝着移动方向，如果是沿着移动方向旋转（自动面向路径切线），如果否不改变自身朝向

飞行物的moveType的类型：直线/S型/抛物线/半径旋转/回旋镖/跟踪，
再一个类型里，不需要分开

举个例子：给了速度就是沿直线移动，再给半径就可以沿着半径画圆旋转，如果sin就可以S型移动，如果加重力等就可以抛物线，还可以增加回旋飞行模式

说下层级关系：
直线移动：向设定方向移动
S型移动：原地上下移动
回旋镖：原地向前再向后
抛物线：原地向上再落下
旋转半径：原地按照半径圆路径移动

层级之间的叠加

直线移动+S型移动=向前移动的同时上下移动
直线移动+回旋镖=直线飞出移动再飞回
直线移动+抛物线=向前抛物线飞出后下落
直线移动+旋转半径=自身按照半径圆形路径移动，同时半径圆形直线移动

直线移动+S型移动+抛物线=自身向前上下移动同时整体抛物线飞出
直线移动+S型移动+回旋镖=自身向前上下移动同时飞出后一定距离按照S型移动飞回
直线移动+S型移动+旋转半径=自身上下移动同时按照半径圆形路径移动，整体向前移动

直线移动+旋转半径+S型移动=自身按照半径圆形路径移动的同时整体向前上下移动
直线移动+旋转半径+抛物线=自身按照半径圆形路径移动的同时整体抛物线飞出，如果反弹，也是按照自身按照半径圆形路径移动的同时整体抛物线反弹
直线移动+旋转半径+回旋镖=自身按照半径圆形路径移动的同时整体向前飞出后一定距离按照圆形路径飞回

直线+S：向前 + 上下
直线+回旋镖：前进/回程
直线+抛物线：向前 + 整体抛飞/落下
直线+旋转半径：螺旋前进
直线+S+抛物线：向前 + 上下 + 整体抛飞
直线+S+回旋镖：上下摆动的飞出/飞回
直线+S+旋转半径：上下 + 绕圈 + 前进
直线+旋转半径+S：等价（顺序不同结果相同）
直线+旋转半径+抛物线：绕圈 + 整体抛飞（若反弹则绕圈+整体抛物线反弹）
直线+旋转半径+回旋镖：绕圈 + 飞出/飞回



远程攻击飞行物命中墙壁或玩家会爆炸
参数：爆炸范围、爆炸伤害、爆炸持续时间(持续时间内一直伤害)、伤害间隔（多少时间伤害一次）
飞行物爆炸动画资源：FlygunBoomAnimation
飞行物爆炸特效资源：FlygunBoomEffectPrefab (支持prefab 或序列帧动画)

未来飞行物 还要死亡区域检测 ，暂时先不考虑，近战攻击和远程飞行物攻击伤害暂时不加入


findmove里的动画、特效、关键帧 不可以 和 findjump里的动画、特效、关键帧混用

findmove
动画findmoveAnimation 里 对应关键帧 findmoveEffectPrefab，关键帧对应的特效是findmoveEffectPrefab
缺少动画findmoveAnimation不能播放特效findmoveEffectPrefab
缺少关键帧findmoveEffectPrefab不能播放特效findmoveEffectPrefab
缺少特效findmoveEffectPrefab不能播特效findmoveEffectPrefab
动画findrestAnimation 里 对应关键帧 findrestEffectPrefab，关键帧对应的特效是findrestEffectPrefab
缺少动画findrestAnimation不能播放特效findrestEffectPrefab
缺少关键帧findrestEffectPrefab不能播放特效findrestEffectPrefab
缺少特效findrestEffectPrefab不能播特效findrestEffectPrefab

reversemove
动画、关键帧、特效同findmove


backmove
只有动画backmoveAnimation  不同于 findmove里的findmoveAnimation动画
动画backmoveAnimation里 对应关键帧 findmoveEffectPrefab，关键帧对应的特效是findmoveEffectPrefab
动画、关键帧、特效同findmove

findjump
动画findjumpAnimation 里 对应关键帧 findjumpEffectPrefab，关键帧对应的特效是findjumpEffectPrefab
缺少动画findjumpAnimation不能播放特效findjumpEffectPrefab
缺少关键帧findjumpEffectPrefab不能播放特效findjumpEffectPrefab
缺少特效findjumpEffectPrefab 不能播特效findjumpEffectPrefab
动画findjumpRestAnimation 里 对应关键帧 findjumpRestEffectPrefab，关键帧对应的特效是findjumpRestEffectPrefab
缺少动画findjumpRestAnimation不能播放特效findjumpRestEffectPrefab
缺少关键帧findjumpRestEffectPrefab不能播放特效findjumpRestEffectPrefab
缺少特效findjumpEffectPrefab 不能播特效findjumpEffectPrefab

reversejump
动画、关键帧、特效同findjump

backjump
只有动画backjumpAnimation  不同于 findjump里的findjumpAnimation 动画
动画backjumpAnimation 里 对应关键帧 findjumpEffectPrefab，关键帧对应的特效是findjumpEffectPrefab
动画、关键帧、特效同findjump


在发现阶段的特效入口按当前事件模式强制过滤：
mode=Move 时仅响应 findmoveEffectPrefab / findrestEffectPrefab
mode=Jump 时仅响应 findjumpEffectPrefab / findjumpRestEffectPrefab
这样，即便移动与跳跃共用同一个动画剪辑、且剪辑里只有“移动事件”，在 Jump 模式下也不会误播移动特效。


编辑器折叠分类功能

出生阶段positionType
选择 point的时候spawnConfig.areaCenter，spawnConfig.areaSize折叠
选择area的时候 spawnPoints、sequentialSpawn折叠

巡逻阶段type
选择straight的时候，参数：jumpSpeed、jumpHeight、gravityScale、jumpDuration、jumpRestDuration这些折叠
选择jump的时候，参数：moveSpeed、acceleration、deceleration、accelerationTime、decelerationTime、moveDuration、restDuration这些折叠
资源：moveAnimation、restAnimation、moveEffectPrefab、restEffectPrefab这些折叠
这些再straight和jump的时候都要有，jumpAnimation、jumpRestAnimation、jumpEffectPrefab、jumpRestEffectPrefab


发现阶段mode
选择move的时候，这些全部折叠findjumpSpeed、findjumpHeight、findgravityScale 、findjumpDuration 、findjumpRestDuration 、backjumpSpeed 、backjumpHeight、backgravityScale 、backjumpDuration 、backjumpRestDuration 、findjumpAnimation、findjumpRestAnimation、findjumpEffectPrefab、findjumpRestEffectPrefab


选择jump的时候，这些全部折叠、findmoveSpeed、findacceleration、findaccelerationTime、finddeceleration、finddecelerationTime、findmoveDuration、findrestDuration、backmoveSpeed、backacceleration、backaccelerationTime、backdeceleration、backdecelerationTime、backmoveDuration、backrestDuration、findmoveAnimation、findrestAnimation、findmoveEffectPrefab、findrestEffectPrefab





 


空中怪物类型
分为出生阶段、巡逻阶段、发现阶段

出生阶段： 同地面出生相同，不需要从新制作，公用一个出生面板，这块不需要从新做，特效动画都是公用面板
只不过地面出生会有一个重力，空中怪物出生是没有重力的，所以会漂浮在空中出生，不会落地，这块可以再原有的地面出生加一个空中出生选项，选了空中出生就不会落到地面上
特效、动画、触发特效关键帧都是和地面出生一样的公用


空中巡逻阶段：
设置选项：怪物是否可以穿透场景 或者 不能穿透（如果不能穿透需要撞墙后朝法线方向反弹）
增加选项：怪物是否一直朝向移动的方向 ，是朝向，否不朝向


增加新的空中巡逻移动列表+， element0、 element1等，从上到下依次执行 或 随机（可以配置不同空中巡逻移动）
基础空中移动：
在一个方形区域内（areaCenter、areaSize）随机朝不同方向移动，每次移动后可以静止休息，移动有加速度、加速度时间，减速度、减速度时间，匀速速度、匀速时间，同地面移动一样，
速度0，再加速度时间内，升到1，再1的匀速速度运行匀速时间后减速，由速度1，再减速度时间内，速度降到0


特殊移动：
这里要定义一个空中怪物的飞行类型，再随机朝不同方向移动的同时，自身路径种类：S型路径移动、半径圆形路径移动
（这个类似地面类型里攻击飞行物）

S型路径移动：上下移动
参数：
上下摆动频率和强度


基础空中移动 可以 和 特殊移动叠加


从新看下逻辑
1选择了空中阶段（airPhaseConfig.airPhaseID=0），出生后要悬浮再空中不会落地
如果先择了地面阶段（airPhaseConfig.groundPhaseID=0），出生后落地

2再以下区域参数

AreaRandom（区域内随机方向，移动时间结束就改变方向）
段起点随机挑一个2D方向，按该方向直线推进（用配置的加/匀/减速）。
碰到区域边界时“反弹”：向量反射，位置夹回区域内，速度标量不变。
朝向只看水平分量：x 改变正负时才左右翻面；纯竖直反弹不改变朝向（不做“上下转向”）。
正弦摆动沿当前运动方向的法线（看起来像“蛇形”）。

AreaRandomH（区域内给一个随机45f, -45f, 135f, -135f角度方向，移动时间结束就改变方向，按照随机45f, -45f, 135f, -135f角度方向，撞到墙壁后的转向和移动同AreaRandom规则）
段起点随机挑一个2D方向，按该方向直线推进（用配置的加/匀/减速）。
碰到区域边界时“反弹”：入射角等于反射角，速度标量不变
朝向只看水平分量：x 改变正负时才左右翻面；纯竖直反弹不改变朝向（不做“上下转向”）。
正弦摆动沿当前运动方向的法线（看起来像“蛇形”）。

AreaRandomH与AreaRandom的区别就是移动时间结束后是否从新改变方向


AreaHorizontal（水平）
只在 X 轴向左右移动（主速度为水平，Y 不随主运动改变；若开正弦，仅用于上下摆动）。
触到左/右边界时“立即反向”：把水平方向符号翻转（左→右或右→左），并把位置夹回边界内；不做斜向反射。
朝向随水平正负翻转；不会因为上下摆动而改变朝向。

AreaVertical（竖直）
只在 Y 轴向上下移动（主速度为竖直，X 不随主运动改变；若开正弦，仅用于左右摆动）。
触到上/下边界时“立即反向”：把竖直方向符号翻转（上→下或下→上），并把位置夹回边界内；不做斜向反射。
朝向保持初始左右面向，不因上下移动改变；只有当出现显著水平分量（一般不会）才会发生“水平翻面”。

反弹点区域area使用boxcollider2d的中心点，场景碰撞体使用boxcollider2d

3airStageConfig.patrol.elements.Array.data[0].sinEnabled
这个水平摆动不一定是水平，要看区域移动类型决定朝向哪里摆动，摆动方向与移动方向垂直

空中巡逻阶段资源

动画
SkymoveAnimation
SkyrestAnimation
特效
SkymoveEffectPrefab
SkyrestEffectPrefab
动画里播放特效事件关键帧
SkymoveEffectPrefab
SkyrestEffectPrefab
特效释放的锚点(增加空中特效锚点)
fxSkyMovePoint
fxSkyRestPoint



空中空中发现阶段：玩家进入怪物发现距离后，怪物就脱离巡逻阶段，脱离AREA巡逻区域失效，如果玩家脱离怪物发现阶段，怪物会回到巡逻区域，播放巡逻阶段的动画、特效、速度参数，继续再巡逻区域巡逻
当玩家进入怪物的发现阶段，怪物会跟踪玩家

空中发现阶段参数与功能（类似地面巡逻阶段的发现）：
三档水平距离(Gizmos:绿=发现,白=后退,黑=倒退，类似地面阶段发现的辅助显示)
SkyfindRange：小于等于该距离进入跟踪状态，跟踪到玩家附近，不会与玩家重叠，跟踪的参考点以怪物根物体Monster_test_Root下monsterDistPoint点，与玩家的PlayerRoot下的PlayerDistPoint点作为检测（这个再怪物Monster_test_Root下的inspector下的monsterDistPoint和playerDistPoint已经有功能）期间撞到建筑物不转向

SkyreverseRange：小于等于该距离进入后退状态，玩家转向背对玩家后退移动，后退的方向是跟踪状态最后转换成后退/倒退状态的相反角度，例如：跟踪最后的角度是30度，这时候进入倒退/后退后的角度方向30度+180度，期间撞到建筑物转向

SkybackRange：小于等于该距离进入到退状态，玩家面朝玩家倒退移动，倒退的方向是跟踪状态转最后换成后退/倒退状态的相反角度，例如：跟踪最后的角度是30度，这时候进入倒退/后退后的角度方向30度+180度，期间撞到建筑物不转向

空中发现阶段后退检测周期性屏蔽，当SkyreverseRange和SkybackRange屏蔽的时候进入SkyfindRange阶段，暂时将SkyreverseRange和SkybackRange的距离设置成0，等SkybackDCTMin和SkybackDCTMax时间过后恢复成设置的SkyreverseRange和SkybackRange参数
SkybackDCTMin：将SkyreverseRange和SkybackRange的距离设置成0的最短时间
SkybackDCTMax：将SkyreverseRange和SkybackRange的距离设置成0的最长时间
参考下地面阶段发现的backDCTMin和backDCTMax的底层设计

朝向：两个选项（一直朝向玩家移动的方向、一直朝向玩家水平移动的方向）这个以Monster_test_Root的子物体monsterDistPoint作为自转的点
朝向已SkyreverseRange和SkybackRange生效，这两个状态会一直朝向玩家，只不过这里设置是任意角度还是水平角度，SkyreverseRange失效，因为怪物会背对玩家



空中发现阶段 资源（Move：Skyfind/Skyretreat 共用；Skyback 仅 move 动画不同）

动画
SkyFind/SkyRetreat Move Animation：发现时候移动动画
SkyFind/SkyRetreat Rest Animation：发现时候休息动画

特效
SkyFind/SkyRetreat Move FX：发现时候移动播放特效
SkyFind/SkyRetreat Rest FX：发现时候休息播放特效

动画里播放特效事件关键帧
SkyfindmoveEffectPrefab：发现时候移动动画上的事件关键帧特效
SkyfindrestEffectPrefab：发现时候休息动画上的事件关键帧特效

空中特效锚点（根物体下Inspector，fxSkyRestPoint的下方生成）
fxSkyfindMovePoint：发现时候移动播放特效的位置点
fxSkyfindRestPoint：发现时候休息播放特效的位置点

空中发现阶段随机播放发现动作
SkyfindRandomOrder：发现阶段的列表是否随机，否顺序播放

空中发现阶段移动列表，list
空中follow阶段参数
SkyhomingFrequency：跟新角度的频率（参考地面发现阶段攻击飞行物跟踪）
SkyhomingStrength：跟踪强度（参考地面发现阶段攻击飞行物跟踪）
SkyfindmoveSpeed：匀速速度
Skyfindacceleration：加速度
SkyfindaccelerationTime：加速度时间
Skyfinddeceleration：减速度
SkyfinddecelerationTime：减速度时间
SkyfindmoveDuration：匀速速度时间
SkyfindrestMin：休息最小时间
SkyfindrestMax：休息最大时间

SkysinEnabled 启用上下摆动（S型），参考空中巡逻阶段的底层，沿着移动的方向
上下摆动频率
下辖摆动幅度

空中backstep阶段参数
SkybackmoveSpeed：匀速速度
Skybackacceleration：加速度
SkybackaccelerationTime：加速度时间
Skybackdeceleration：减速度
SkybackdecelerationTime：减速度时间
SkybackmoveDuration：匀速速度时间
SkybackrestMin：休息最小时间
SkybackrestMax：休息最大时间




空中发现攻击（可以直接引用地面阶段的发现攻击底层，只是参数和资源不同）

再空中发现动作列表（count=1）下面增加发现攻击（可以直接引用地面阶段的发现攻击底层，只是参数和资源不同）

SkyattacksRandomOrder空中随机播放攻击动作

空中攻击列表-空中攻击0

空中通用时序
SkyattackDuration：本次攻击的时间窗口（秒）。在该时间内可循环播放攻击动画并触发效果
SkyrepeatedHitsCount：在 attackDuration 时间窗内，攻击动画循环播放的次数（动画播完一遍算一次
SkyattackRestMin：攻击结束后进入攻击休息区间下限（秒）
SkyattackRestMax： 攻击结束后进入攻击休息区间上限（秒）

空中近战
空中近战触发距离：在这个距离内触发近战攻击 ，辅助线框的颜色绿色
空中近战动画：SkyattackAnimation
空中近战特效：SkyattackEffectPrefab；空中近战特效再动画内事件播放关键帧：SkyattackEffectPrefab；空中近战攻击的关键帧：SkyattackAnimationstart、SkyattackAnimationend

空中近战攻击释放特效点的路径SkyattackSpawnChildPath（参考地面近战攻击的路径逻辑）
空中命中子物体路径：meleeHitboxChildPath

空中远程
空中远程触发距离：在这个距离内触发远程攻击，辅助线框的颜色蓝色
空中远程动画：SkyattackFarAnimation
空中远程特效：SkyattackFarEffectPrefab；空中远程特效再动画内事件播放关键帧：SkyattackFarEffectPrefab；空中远程飞行物再动画内事件播放关键帧：SkyattackFarFire

Skyprojectile配置（飞行物配置）
飞行物发射队列
SkycountPerBurst：一次动画触发发射的数量
SkyintraBurstInterval：同一触发内连发的间隔（秒）
SkylifeTime：投射物存活时间（秒）

飞行物扇形分布
SkyspreadAngle：多发时的扇形角度（度），0 表示同向
SkyspreadUniform：多发时在扇形内是否均匀分布（false 则随机分布）

飞行物表现资源
SkyFlygunAnimation：飞行中的动画名（飞行物自己的动画）
SkyFlygunEffectPrefab：飞行中的特效Prefab（飞行物的特效）
SkyattackFarSpawnChildPath：空中发射飞行物的点路径（参考地面远程攻击飞行物的路径逻辑）

飞行物自身旋转
SkyselfRotate：是否飞行物自身旋转，勾上自身旋转
xyz：再不同轴向自转
SkyselfRotateSpeedDeg：旋转速度（度/秒），对勾选的轴生效

SkyfaceAlongPath勾选后：根对象沿移动方向自动朝向；若“自身旋转”启用，本项失效

飞行物发射朝向
SkyspawnAim下 ：Skytowards player / Skyhorizontal to player
Skytowards player=朝向玩家飞；Skyhorizontal to player=按水平朝向玩家飞（忽略Y）

飞行物爆炸表现
Skyradius：爆炸半径（米）
Skyduration：爆炸表现持续时间（秒）
Skyinterval：爆炸伤害/子效果的tick间隔（秒）
SkyFlygunBoomAnimation：爆炸动画名（飞行物转到玩家、场景，或生命周期结束，爆炸的时候释放爆炸动画）
SkyFlygunBoomEffectPrefab：爆炸特效Prefab（飞行物转到玩家、场景，或生命周期结束，爆炸的时候释放爆炸特效）

飞行物直线移动
SkylinearEnabled：启用直线基线推进（speed/accel等），启用后显示下面的参数，关闭后不使用直线推进（回旋镖返程不受影响）
Skyspeed：初始速度（米/秒）
Skyaccel：加速度（米/秒²），当 accelTime<=0 时使用该值
SkyaccelTime：加速时间（秒），>0 时按时间插值至目标速度
Skydecel：减速度（米/秒²），当 decelTime<=0 时使用该值
SkydecelTime：减速时间（秒），>0 时按时间插值至 0
SkymoveDuration：匀速阶段持续时间（秒），0 表示无匀速直接进入减速/结束

飞行物S型直线（侧向正弦）
SkysinEnabled：启用 S 型侧向偏移，启用后显示下面的参数
SkysinAmplitude：正弦摆动幅度
SkysinFrequency：正弦摆动频率（Hz）

飞行物抛物线（重力）
SkyparabolaEnabled：启用抛物线重力效果，启用后显示下面的参数
SkygravityScale：抛物线运动重力缩放
SkybounceCoefficient：落地反弹系数（0=不反弹，>1 可越弹越高，不夹 [0,1]）
SkybounceEnergyMode：constant/decay to zero  反弹能量模式：Constant=每次相同；DecayToZero=每次按衰减因子衰减，低于阈值即销毁
SkybounceDecayFactor：每次反弹额外衰减因子（<1 逐渐变小；=1 不变；>1 逐渐变大）
SkyparabolaApexHeight：最高点高度（米，>0 时用来计算初始竖直速度 vy0 = sqrt(2*g*h)）
SkybounceEndVyThreshold：竖直反弹速度低于该阈值则销毁（仅 DecayToZero 生效）

飞行物跟踪导弹
SkyhomingEnabled：启用跟踪，按频率刷新朝向目标（频率低更棱角，频率高更顺滑），启用后显示下面的参数
SkyhomingFrequency：跟踪频率（Hz），每秒更新朝向的次数。0 表示不更新（关闭）
SkyhomingStrength：跟踪强度，1完全跟踪，0不跟踪

飞行物半径旋转（相对载体，pathtangent空间）
SkyorbitEnabled：启用半径旋转，相对载体按半径做圆周偏移，启用后显示下面的参数
SkyorbitRadius：半径（米）
SkyorbitAngular：每次要旋转的角度（度）。例如 90/180/360。达到该角度后从0重新开始下一次 sweep。
SkyorbitSweepSpeedDeg：沿半径转动的角速度（度/秒）。符号决定方向：>0 逆时针，<0 顺时针。

飞行物回旋镖
SkyboomerangEnabled：启用回旋镖，飞到最远距离 -> 停顿 -> 返回起点/发射者，启用后显示下面的参数
SkyboomerangOutMaxDistance：飞出最远距离（米）：到达后进入‘最远距离停顿’阶段"
SkyboomerangApexStopTime：最远距离停顿时间（秒）
SkyboomerangBackUniformSpeed：回程匀速目标速度（米/秒）。>0 时作为回程速度目标
SkyboomerangBackUniformTime：回程由当前速度匀速过渡到目标速度所需时间（秒）；=0 则瞬时切换
SkyboomerangBackAccel：回程加速度（米/秒²），当 backAccelTime<=0 时使用该值
SkyboomerangBackAccelTime：回程加速时间（秒），>0 时按时间插值到匀速目标
SkyboomerangBackDecel：回程减速度（米/秒²），当 backDecelTime<=0 时使用该值（用于接近终点减速，可选）
SkyboomerangBackDecelTime：回程减速时间（秒），>0 时按时间插值至 0（用于接近终点减速，可选）

攻击叠加运动模式
SkyattackMotionMode 下： none\Skyfollowmove
None=不叠加空中追踪移动；Skyfollowmove=攻击期间叠加追踪移动

选择none不使用攻击移动

选择Skyfollowmove

增加攻击中跟踪（功能类似空中发现中跟踪，SkyhomingFrequency与SkyhomingStrength）

移动中攻击近战
SkyattackmoveSpeedMelee：近战时的攻击位移速度
SkyattackaccelerationMelee：近战时的攻击位移加速度
SkyattackaccelerationTimeMelee：近战时的加速时间
SkyattackdecelerationMelee：近战时的减速度
SkyattackdecelerationTimeMelee：近战时的减速时间
SkyattackmoveDurationMelee：近战时的总位移时长（含加/匀/减）

移动中攻击远程
SkyattackmoveSpeedRanged：远程时的攻击位移速度
SkyattackaccelerationRanged：远程时的攻击位移加速度
SkyattackaccelerationTimeRanged：远程时的加速时间
SkyattackdecelerationRanged：远程时的减速度
SkyattackdecelerationTimeRanged：远程时的减速时间
SkyattackmoveDurationRanged：远程时的总位移时长（含加/匀/减）



添加groundPhase勾选，勾上就是永远运行地面阶段，那么怪物出生那一刻开始就要有重力，落到地面，地面阶段自己循环，
不勾选就不执行地面阶段逻辑，这个已经实现

添加airPhase勾选，勾上就是永远运行空中阶段，那么怪物出生那一刻开始就要没有重力，空中漂浮，空中阶段自己循环，
不勾选就不执行空中阶段逻辑，这个已经实现


地面与空中 相互转换配置
如果地面阶段和空中阶段全部勾上
显示出选择地面优先 还是 空中优先
选择地面优先就从地面阶段开始，选择空中优先从空中阶段开始

转换条件
1怪物血量HP到一定程度转换，这个时候不管怪物在做什么都要直接进入下一阶段
2攻击列表执行次数判断
怪物地面的时候近战攻击 或 远程攻击 的 攻击列表（count=1）达到执行次数就 进入空中阶段
怪物空中的时候近战攻击 或 远程攻击 的 攻击列表（count=1）达到执行次数就 进入地面阶段


3怪物只有再地面发现阶段的攻击或空中发现阶段的攻击才会进入到地面与空中转换，巡逻和发现不会转换

4当HP满足条件的时候就立刻转换，HP越来越少，所以就一次，HP转换后就不会再按照HP条件转换了，但攻击列表次数转换仍然存在

5状态切换：地面阶段-地面到空中过度-空中阶段 或者 空中阶段-空中到地面过度-地面阶段
例如：地面执行了1次地面面阶段的攻击列表逻辑后，启动地面到空中过度，升空时间：匀加速时间+匀速时间+匀减速时间之和，然后转换到空中阶段
例如：空中执行了1次空中面阶段的攻击列表逻辑后，启动空中到地面过度，下降时间：匀加速时间+匀速时间+匀减速时间之和，然后转换到地面阶段

只需要计数空中阶段攻击列表次数或地面阶段攻击列表次数，到达次数后打开airPhaseConfig.groundPhase，关闭airPhaseConfig.airPhase，或者，打开airPhaseConfig.airPhase，关闭airPhaseConfig.groundPhase，不要调整地面或空中的功能

只在攻击列表 count=1 的那条攻击被执行时才算 1 次，count=1到=2到=3这样一直执行下去才算一次

另外下降动画或升空动画直播放一次，保持最后一帧，只有替换状态的时候会换动画，举例：地面到空中转换动画到达最后一帧，继续上升，到达上升时间后转换动画

只需要计数空中阶段攻击列表次数或地面阶段攻击列表次数，到达次数后打开airPhaseConfig.groundPhase，关闭airPhaseConfig.airPhase，或者，打开airPhaseConfig.airPhase，关闭airPhaseConfig.groundPhase，不要调整地面或空中的功能

只勾airPhaseConfig.groundPhase出生在地面，这个已经实现
只勾airPhaseConfig.airPhase出生在空中，这个已经实现
二者都勾选，这时候再选择Air First，相当于先执行空中阶段，出生在空中，执行空中阶段逻辑，然后接空中到地面转换，到地面以后再转换成地面阶段 
或者
二者都勾选，这时候再选择Ground First，相当于先执行地面阶段，出生在地面，执行地面阶段逻辑，然后接地面到空中转换，到空中以后再转换成空中阶段 

参数资源

地面到空中转换 
升空中的匀速速度、匀速时间、匀加速、匀加速时间、匀减速、匀减速时间（公用之前角色的移动底层）
升空时候的动画、特效、播放特效关键帧、特效锚点等
资源：

地面到空中转换增加一个选项，是否更换碰撞体，如果勾选，就可以从新指定碰撞体切换

空中到地面转换
下降中的匀速速度、匀速时间、匀加速、匀加速时间、匀减速、匀减速时间（公用之前角色的移动底层）
下降中候的动画、特效、播放特效关键帧、特效锚点等
资源：
Skytoground动画
SkytogroundPrefab特效
SkytogroundPrefab动画播放特效事件关键帧
Fxskytogroundpoint特效释放的锚点（再怪物inspetor下的fxSkyfindRestPoint的下方）


Groundtosky动画
GroundtoskyPrefab特效
GroundtoskyPrefab动画播放特效事件关键帧
Fxgroundtoskypoint特效释放的锚点（再怪物inspetor下的fxSkyfindRestPoint的下方）


空中到地面转换增加一个选项，是否更换碰撞体，如果勾选，就可以从新指定碰撞体切换

资源参数放在airPhaseConfig.showAirGizmosManual的下方


辅助线显示
地面辅助线显示选项：勾选的时候显示地面阶段发现 follow、backstep、攻击近战、攻击远程辅助线（不管airPhaseConfig.groundPhaseID是多少，显示或不显示辅助线无关）这个已经实现
空中辅助线显示选项：勾选的时候显示空中阶段发现 follow、backstep、攻击近战、攻击远程辅助线（不需airPhaseConfig.airPhaseIDD是多少，显示或不显示辅助线无关）这个已经实现

是否需要单独脚本

玩家击中怪物的命中效果
怪物被击中时候的资源
动画：MasterHitAnimaton
特效：MasterHitPrefab
特效在动画播放事件关键帧：FxMasterHitPrefab
参数：击中的时候硬直时间，硬直表示怪物不会动

相应参数放到空中配置下面

死亡逻辑
怪物血量清零、触发死亡区域
死亡的时候播放资源
死亡动画：MasterDieAnimaton
死亡特效：MasterDiePrefab
死亡特效在动画播放事件关键帧：FxMasterDiePrefab
死亡动画播放完删除怪物

相应参数放到怪物命中下面




武器系统配置

在PlayerRoot下Component下Ground Point下Flip下player下Inspector下的AnimationEventRelay脚本，这里只指定attackHub和shieldHub
然后把vfxHubs下的vfxHubs.Array.data[0]与vfxHubs.Array.data[1]移动到PlayerRoot下Component下Ground Point下Flip下HandSocketR下WeaponOffset下player_weapon下Inspector下的AttackEventHub脚本配置里，


先考虑角色武器动画和特效相关
玩家自身的攻击动画需要替换PlayerRoot下Component下Ground Point下Flip下player下的Inspector下的animator状态机下的
player_attack、player_attack_end、player_duck_attack、player_duck_attack_end、player_jump_attack、player_jump_downForward_attack
每一种武器的角色攻击动画长短不同，所以从新设置关键帧事件

在PlayerRoot下Component下Ground Point下Flip下player下Inspector下的AttackEventHub脚本，这里指定角色武器攻击动画、特效
在PlayerRoot下Component下Ground Point下Flip下HandSocketR下WeaponOffset下player_weapon下Inspector下的AttackEventHub脚本，这里指定武器自身的攻击动画、特效

新增武器自身攻击的boxcollider2D的物理伤害检测，并且给武器自身动画指定伤害关键帧开始和结束
每种武器的攻击的boxcollider2D的物理伤害检测范围不同

现在武器要增加很多，武器还会有远程飞行物，怎么设计这个武器系统，怎么配置更简单






武器自身
武器ID
伤害：玩家的伤害碰撞体，触碰到怪物的检测体，减少怪物的血量，并且每次给怪物造成伤害都会触发怪物的命中效果（动画、特效等）当怪物血量为0得时候，怪物死亡

近战武器
武器自身动画prefab，替换PlayerRoot下Component下Ground Point下HandSocket下WeaponOffset下的player_weapon动画资源
武器自身特效（支持动画和prefab特效，类似怪物编辑器）增加特效播放列表，武器的特效可以指定多个特效
武器自身释放特效动画关键帧
武器自身命中怪物的检测体（参考下怪物的检测体）
武器自身命中动画关键帧事件区间（参考怪物编辑器的攻击关键帧区间）
武器自身攻击特效的初始位置锚点

远程武器
武器飞行物（参考怪物编辑器的飞行物配置）

飞行物发射队列
PlayercountPerBurst：一次动画触发发射的数量
PlayerintraBurstInterval：同一触发内连发的间隔（秒）
PlayerlifeTime：投射物存活时间（秒）

飞行物扇形分布
PlayerspreadAngle：多发时的扇形角度（度），0 表示同向
PlayerspreadUniform：多发时在扇形内是否均匀分布（false 则随机分布）

飞行物表现资源
PlayerFlygunAnimation：飞行中的动画名（飞行物自己的动画）
PlayerFlygunEffectPrefab：飞行中的特效Prefab（飞行物的特效）
PlayerattackFarSpawnChildPath：空中发射飞行物的点路径（参考地面远程攻击飞行物的路径逻辑）

飞行物自身旋转
PlayerselfRotate：是否飞行物自身旋转，勾上自身旋转
xyz：再不同轴向自转
PlayerselfRotateSpeedDeg：旋转速度（度/秒），对勾选的轴生效

PlayerfaceAlongPath勾选后：根对象沿移动方向自动朝向；若“自身旋转”启用，本项失效

飞行物发射朝向
PlayerspawnAim下 ：Skytowards player / Skyhorizontal to player
Playertowards player=朝向玩家飞；Skyhorizontal to player=按水平朝向玩家飞（忽略Y）

飞行物爆炸表现
Playerradius：爆炸半径（米）
Playerduration：爆炸表现持续时间（秒）
Playerinterval：爆炸伤害/子效果的tick间隔（秒）
PlayerFlygunBoomAnimation：爆炸动画名（飞行物转到玩家、场景，或生命周期结束，爆炸的时候释放爆炸动画）
PlayerFlygunBoomEffectPrefab：爆炸特效Prefab（飞行物转到玩家、场景，或生命周期结束，爆炸的时候释放爆炸特效）

飞行物直线移动
PlayerlinearEnabled：启用直线基线推进（speed/accel等），启用后显示下面的参数，关闭后不使用直线推进（回旋镖返程不受影响）
Playerspeed：初始速度（米/秒）
Playeraccel：加速度（米/秒²），当 accelTime<=0 时使用该值
PlayeraccelTime：加速时间（秒），>0 时按时间插值至目标速度
Playerdecel：减速度（米/秒²），当 decelTime<=0 时使用该值
PlayerdecelTime：减速时间（秒），>0 时按时间插值至 0
PlayermoveDuration：匀速阶段持续时间（秒），0 表示无匀速直接进入减速/结束

飞行物S型直线（侧向正弦）
PlayersinEnabled：启用 S 型侧向偏移，启用后显示下面的参数
PlayersinAmplitude：正弦摆动幅度
PlayersinFrequency：正弦摆动频率（Hz）

飞行物抛物线（重力）
PlayerparabolaEnabled：启用抛物线重力效果，启用后显示下面的参数
PlayergravityScale：抛物线运动重力缩放
PlayerbounceCoefficient：落地反弹系数（0=不反弹，>1 可越弹越高，不夹 [0,1]）
PlayerbounceEnergyMode：constant/decay to zero  反弹能量模式：Constant=每次相同；DecayToZero=每次按衰减因子衰减，低于阈值即销毁
PlayerbounceDecayFactor：每次反弹额外衰减因子（<1 逐渐变小；=1 不变；>1 逐渐变大）
PlayerparabolaApexHeight：最高点高度（米，>0 时用来计算初始竖直速度 vy0 = sqrt(2*g*h)）
PlayerbounceEndVyThreshold：竖直反弹速度低于该阈值则销毁（仅 DecayToZero 生效）

飞行物跟踪导弹
PlayerhomingEnabled：启用跟踪，按频率刷新朝向目标（频率低更棱角，频率高更顺滑），启用后显示下面的参数
PlayerhomingFrequency：跟踪频率（Hz），每秒更新朝向的次数。0 表示不更新（关闭）
PlayerhomingStrength：跟踪强度，1完全跟踪，0不跟踪

飞行物半径旋转（相对载体，pathtangent空间）
PlayerorbitEnabled：启用半径旋转，相对载体按半径做圆周偏移，启用后显示下面的参数
PlayerorbitRadius：半径（米）
PlayerorbitAngular：每次要旋转的角度（度）。例如 90/180/360。达到该角度后从0重新开始下一次 sweep。
PlayerorbitSweepSpeedDeg：沿半径转动的角速度（度/秒）。符号决定方向：>0 逆时针，<0 顺时针。

飞行物回旋镖
PlayerboomerangEnabled：启用回旋镖，飞到最远距离 -> 停顿 -> 返回起点/发射者，启用后显示下面的参数
PlayerboomerangOutMaxDistance：飞出最远距离（米）：到达后进入‘最远距离停顿’阶段"
PlayerboomerangApexStopTime：最远距离停顿时间（秒）
PlayerboomerangBackUniformSpeed：回程匀速目标速度（米/秒）。>0 时作为回程速度目标
PlayerboomerangBackUniformTime：回程由当前速度匀速过渡到目标速度所需时间（秒）；=0 则瞬时切换
PlayerboomerangBackAccel：回程加速度（米/秒²），当 backAccelTime<=0 时使用该值
PlayerboomerangBackAccelTime：回程加速时间（秒），>0 时按时间插值到匀速目标
PlayerboomerangBackDecel：回程减速度（米/秒²），当 backDecelTime<=0 时使用该值（用于接近终点减速，可选）
PlayerboomerangBackDecelTime：回程减速时间（秒），>0 时按时间插值至 0（用于接近终点减速，可选）



玩家角色

角色攻击关键帧说明
一、武器本体动画与偏移

SetWeaponXYOffsetStr(string xy)
功能：设置武器播放根的局部偏移（weaponOffsetRoot.localPosition 的 x/y）。
参数：字符串格式的“x,y”或“x;y”或“x y”（小数用英文点）。示例："0.02,-0.03"。
用法：偶发微调刀身/拖尾的出手锚点。一般很少在每把武器的关键帧里频繁用，更多用于一次性调位。
PlayWeapon(string stateName)
功能：通过 attackHub 播放“武器 Animator”的某个状态（如 weapon_slashA）。
用法：若你不想用 EvtWeaponPlay，也可以直接在关键帧调用它；二者等价，EvtWeaponPlay 只是更明确语义。
StopWeapon()
功能：通过 attackHub 把武器 Animator 切回 idle，并归还“脱体”父子关系、可选复位偏移。
用法：中途只停止“武器本体动画”而不停特效时使用；若要“武器+特效一起收尾”，用 EvtWeaponEnd（见下）。
二、武器与角色层特效（VFX）

SetVfxXYOffsetStr(string xy)
功能：对 vfxHubs 列表中的每个 AttackEventHub 设置同样的 XY 偏移。
用法：多 FX 同步移动的特殊需求；常规无需频繁使用。
PlayVfx(string stateName)
功能：广播到 vfxHubs，每个 hub 播放其 Animator 的该状态。
用法：在关键帧触发刀光、冲击波等特效（如果这些 FX 是用 Animator 状态而不是 Prefab 粒子）。
StopVfx()
功能：广播停止 vfxHubs（切回各自 idle）。
用法：结尾收尾，或中途转场时清理 FX。注意 EvtWeaponEnd 也会调用 StopVfx。
三、盾牌显示（与攻击无直接关系，供盾的动画用）

SetShieldXYOffsetStr(string xy)
PlayShield(string stateName)
StopShield()
PlayShieldStanding()
PlayShieldDuck()
功能：与“武器/特效”的 Play/Stop 相同，但针对 shieldHub。
用法：只在举盾相关的动画里用；普通武器攻击的关键帧中一般不要调用，避免干扰。
四、玩家控制逻辑转发（PlayerController）

OnWallJumpForwardUnlock()
功能：转发给 PlayerController.OnWallJumpForwardUnlock，用于墙跳动画到达解锁帧。
用法：只放在墙跳转身的动画关键帧；与武器无关。
OnAttackEnd()
OnDuckAttackEnd()
功能：转发给 PlayerController 的攻击收尾回调，解除 groundAttackActive 等状态。
用法：通常由玩家 Animator 的 *_attack_end 动画中尾帧调用；务必与 PlayerController 的现有配置一致。不要把它当作“武器收尾”，武器的收尾用 EvtWeaponEnd。




角色攻击配置


检查三个 prefab 的组件

Weapon_001
Animator（武器本体动画控制器）
AttackEventHub（weaponAnimator 指向 Animator）
HitboxController（已配置命中体列表，Collider2D isTrigger=true 初始禁用）
weapon_001_effect
Animator（特效 A 控制器）
AttackEventHub（weaponAnimator 指向 Animator）
weapon_001_effectstar
Animator（特效 B 控制器）
AttackEventHub（weaponAnimator 指向 Animator）
创建武器定义资源

在项目中右键 Create → Game → Weapon Definition，命名为 WeaponDef_001
填写字段：
id：Weapon_001（或你喜欢的唯一字符串）
playerOverride：玩家 6 段攻击动画的覆盖控制器（AnimatorOverrideController）
weaponPrefab：Weapon_001
effectPrefab：weapon_001_effect
effectStarPrefab：weapon_001_effectstar
baseDamage：比如 20
绑定 WeaponManager

PlayerRoot → Component 上的 WeaponManager 已挂好，确保以下引用正确：
Player Animator → Flip/player 上的 Animator
Relay → Flip/player 下的 AnimationEventRelay 组件
Weapon Slot → HandSocketR/WeaponOffset/player_weapon（Transform）
Vfx Slot → HandSocketR/WeaponOffset/VfxWeaponOffset/player_weapon_effect（Transform）
Vfx Star Slot → HandSocketR/WeaponOffset/VfxWeaponOffsetstar/player_weapon_effectstar（Transform）
在 WeaponManager 的 Database 列表里，增加一个元素，把 WeaponDef_001 拖进去
关键帧事件（只在玩家攻击动画 Clip 上）

在 player_attack 等 6 段玩家攻击 Clip 中，按节奏打命中窗口：
窗口开始帧：EvtHitOn(0)
窗口结束帧：EvtHitOff(0)
如有第二段/不同范围：EvtHitOn(1)/EvtHitOff(1) …
不添加任何武器/特效的播放事件。武器和特效的表现由它们自己的 Animator 或现有管线自治播放。

HitboxController下多个伤害碰撞体
在 Hitboxes 列表里把 Hitbox1 的 Collider2D 拖进来，确保顺序是：
Element 0 → Hitbox0 的 Collider2D
Element 1 → Hitbox1 的 Collider2D
确认两个 Collider2D 都是 isTrigger=true，默认 enabled=false。
应用 prefab 覆盖（Apply），或者在运行时选中实例确认列表确实有两个元素。
在玩家攻击 Clip 中成对配置事件：
某段窗口用第一个命中体：EvtHitOn(0) → EvtHitOff(0)
另一段窗口用第二个命中体：EvtHitOn(1) → EvtHitOff(1)
如果还是只看到 Hitbox0，核对是否把 EvtHitOn(1)/EvtHitOff(1) 打在了实际会播放的那个 Clip 上；以及是否把 Off(1) 提前写成了 Off(0) 导致窗口被提前关掉。


物理碰撞体逻辑
站立到下蹲后  Col_Standing要关闭 Col_Duck打开
下蹲到站立后  Col_Duck关闭Col_Standing要打开
下蹲到跳跃 Col_Duck关闭Col_Standing要打开
跳跃到下蹲 Col_Standing要关闭 Col_Duck打开
跳跃到站立或站立到跳跃 都是 Col_Standing打开 ，Col_Duck关闭

下蹲头顶检测体不可站立
下蹲的时候头顶的检测体显示并且检测场景中的碰撞体，当检测到后下蹲期间玩家松开S下，也不会自动站立
检测体是collider is trigger 


受伤、死亡
需求要点梳理
受击来源与层：
近战：怪物子物体的近战 Hitbox（Layer: mhitbox）
贴身：怪物自身子物体 MHitbox（Layer: monster）
远程：飞行物 Projectile 的碰撞（Layer: projectile）和飞行物爆炸范围伤害
伤害来自于怪物近战、贴身、远程，飞行物爆炸伤害 
受击效果：
扣血并播放受伤动画
根据命中方向产生强制位移（Knockback）：命中玩家正面则向后+向下；命中背面则向前+向下
强制位移持续时间可调，位移距离/力度可调
在强制位移期间玩家不可操作，并且拥有无敌（I-Frame），结束后无敌关闭
空中与地面一致（同一物理底层）
无敌规则：
只有受伤后有一段无敌时间（与强制位移时间一致）
闪避后退 BackFlash 不提供无敌
除受伤后这段时间外，任何命中都会受伤
死亡：
血量降为 0 或触碰场景“即死”触发器（Collider isTrigger，如悬崖）即死亡
死亡时播放死亡动画，死亡期间不可操作
若血量已为 0，直接播死亡动画，同时也产生一次向后（可配置）强制位移
动画循环：
前向受击动画：player_frontHit1 与 player_frontHit2 交替循环
后向受击动画：player_backHit1 与 player_backHit2 交替循环
死亡动画：player_die（不可操作）
使用excel设置怪物的近战、远程、远程爆炸物、自身伤害量
新增加Col_Standing和Col_Duck这个是玩家与场景碰撞体，这个是不能与怪物自身产生碰撞的，所以增加了Hitbox_Standing和Hitbox_Duck，并且给它两个新的层PHitbox，这个曾与怪物的近战、远程、爆炸物、自身的伤害检测体碰撞伤害玩家、播放受伤或死亡动画，产生强制移动
需要给Hitbox_Standing和Hitbox_Duck增加像Col_Standing和Col_Duck的转换（参考下Col_Standing和Col_Duck的转换代码）

把强制位移时间和硬直时间分开，无敌时间归到硬直时间，动画持续时间不需要，因为时间短就提前结束，时间长就最后一帧持续
并且给受伤和死亡各增加一个特效，都是受伤开始和死亡开始播放，不需要动画关键帧，循环或不循环看特效的配置不需要代码，还要特效播放的位置，这个位置可以是角色中心PlayerDistPoint，受伤动画、移动和特效没关系，各自播各自的，受伤动画结束了，特效不需要结束



怪物飞行物命中玩家的规则：
当玩家正面朝右，背面向左，飞行物从右面向左飞来，飞行物撞到玩家，玩家受到伤害，玩家朝向不变仍然是朝向右，受伤位移向左
当玩家背面朝右，正面向左，飞行物从右面向左飞来，飞行物撞到玩家，玩家受到伤害，玩家朝向不变仍然是朝向左，受伤位移向左



铁律/不变规则
请用中文沟通
空中阶段的逻辑不要影响已有地面阶段的逻辑
地面阶段的逻辑不要影响已有空中阶段的逻辑
不要不破坏已经可以的角色操作部分
不要破坏player已经有的逻辑
不改变已有资源/Prefab 的标签与层，补丁仅在代码
不改已有“好用”的变量名。
不新增和现有语义重复的变量名。
优先在原变量、原方法里就地改逻辑，保持接口不变。
不用给我全部代码
修改的代码贴在哪个脚本，要把贴的脚本位置上两句代码和下两句代码给我 
如果是修改函数，给出修改函数部分的整体代码
已经有的逻辑直接引用不要再从新制造
不要修改好以后影响已经完善的动画状态机
修改过的代码不要影响了现在的动画状态机
代码要全部一字不差的看完
如果已经有的功能，代码里查漏补缺
不需要给每句话都给中文注释
不用给全部代码
不用讲为什么，已经改好的不用告诉我，只需要告诉修改的部分
给出的代码，不要丢失变量，自己要验证一遍
不要每句话都有注释


怪物现在可以攻击玩家了，玩家受伤和死亡完成
明天开始 把怪物对玩家的伤害转移到怪物编辑器上，同时 玩家武器也可以攻击怪物


